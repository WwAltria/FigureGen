Bootstrap: library
From: ubuntu:20.04
Stage: build

%files
    FigureGen.F90
    CMakeLists.txt
    cmake

%post
    apt-get update && apt-get install -y software-properties-common
    add-apt-repository universe
    apt-get update && apt-get install -y mpich ghostscript graphicsmagick gdal-bin ffmpeg gmt gmt-dcw gmt-gshhg cmake
    apt-get install -y libhdf5-dev libnetcdff-dev
    mkdir build && cd build && cmake .. -DUSE_MPI=ON -DUSE_NETCDF=ON && make && ls
    apt-get remove -y software-properties-common cmake
    echo 'export PATH="/build:$PATH"' >> $SINGULARITY_ENVIRONMENT
    echo 'export PATH="/usr/lib/gmt/bin:$PATH"' >> $SINGULARITY_ENVIRONMENT
    gs